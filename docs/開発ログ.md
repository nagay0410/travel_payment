# 開発ログ

## 2025-12-28
### Angularプロジェクトの現状レビューと改善実装
- **現状レビュー**:
  - Angular 19, Signals, Standaloneコンポーネントの採用を確認.
  - テスト環境の不備（HttpClient/Routerの提供漏れ）により一部テストが失敗していたため修正.
- **改善実装**:
  - `TripCardComponent`, `StatusBadgeComponent`, `MemberAvatarComponent` を Signal Input (`input()`) および `computed()` ベースにリファクタリング.
  - `CurrencyInputComponent` の `any` 型を排除し、型定義を強化.
  - `AppComponent` の不要なボイラープレート（`app.component.html`）を削除.
  - 基礎ルーティング（`/trips`, `/login`）とプレースホルダコンポーネント（`TripListComponent`, `LoginComponent`）を設定.
- **検証**:
  - 全10件の既存の単体テストがパスすることを確認.
  - 新規作成したルーティングとコンポーネントがビルドエラーを起こさないことを確認.

## 2025-12-30
### フロントエンド全機能実装 (Step 7) の完了
- **認証基盤**: `AuthService`, `AuthInterceptor` を実装し、JWT 認証フローを確立。
- **UI コンポーネント**: `TripCard`, `MemberAvatar`, `StatusBadge`, `CurrencyInput` などの共通部品を Angular Material ベースで構築。
- **主要画面実装**:
  - ログイン (SCR-01), ユーザー登録 (SCR-02)
  - 旅行一覧 (SCR-03), 旅行新規作成 (SCR-04)
  - 旅行ダッシュボード (SCR-05) とそのサブコンポーネント群。
  - 支払い一覧 (SCR-06), 支払い登録 (SCR-07)
  - 精算計算・実行 (SCR-08)
- **UX/品質**:
  - `LoadingInterceptor` による自動ローディング表示。
  - ガラスモルフィズムを取り入れた、プレミアムなダークテーマ・デザイン。
- **検証**:
  - 各コンポーネントの表示、ルーティング、サービス間の Signal 連携が正常であることを確認。

### PostgreSQL 環境構築とビルドエラー修正 (Step 8.0/8.1)
- **環境構築準備**:
  - Infrastructure 層に `DependencyInjection.cs` を実装し、PostgreSQL への接続設定を完了。
  - `appsettings.json` に `ConnectionStrings` を追加。
  - `scripts/db/setup_db.bat` を作成（データベース作成自動化）。
- **デバッグ**:
  - `TripsController.cs` において MediatR の `Unit` 型が未定義だったエラー (CS0246) を `using MediatR;` の追加により修正。
- **検証**:
  - API プロジェクトの正常なビルドを確認。

## 2025-12-31
### API認証機能（ログイン）の実装
- **Application層**:
  - `IJwtTokenGenerator` インターフェース作成（JWTトークン生成用）。
  - `IPasswordHasher` インターフェース作成（パスワードハッシュ化・検証用）。
  - `AuthenticationResult` レコード作成（認証結果を保持）。
  - `LoginCommand` と `LoginCommandHandler` を実装。
- **Infrastructure層**:
  - `JwtSettings` クラス作成（JWT設定のOptionsパターン）。
  - `JwtTokenGenerator` 実装（HS256アルゴリズムによるトークン生成）。
  - `PasswordHasher` 実装（PBKDF2アルゴリズムによる安全なハッシュ化）。
  - `DependencyInjection.cs` 更新（認証サービス、JWTBearer認証の登録）。
- **API層**:
  - `AuthController` の `Login` メソッド実装。
  - `Program.cs` に `UseAuthentication()` 追加。
  - `appsettings.json` に `JwtSettings` セクション追加。
- **テスト**:
  - `LoginCommandTests.cs` 作成（4件のテストケース）。
  - 正常系: 有効な認証情報でのログイン成功。
  - 異常系: ユーザー未発見、パスワード不一致、アカウント無効。
- **検証**:
  - 全テスト成功を確認。
  - ビルド成功を確認。

### ユーザー登録時のパスワードハッシュ化対応
- **Application層**:
  - `CreateUserCommandHandler` に `IPasswordHasher` を注入。
  - `Handle` メソッドでパスワードをハッシュ化してから `User.Create` に渡すように修正。
- **テスト**:
  - `CreateUserCommandTests` を更新し、`IPasswordHasher` のモックを追加。
  - ハッシュ化されたパスワードがユーザーに渡されることを検証。
- **検証**:
  - 全16件のテストが成功。

### ユーザー登録機能 (フロントエンド) の実装
- **AuthService**:
  - `register` メソッドを追加（`POST /api/users` を呼び出し）。
- **RegisterComponent**:
  - `AuthService.register` を呼び出すように `onSubmit` を実装。
  - 成功時: スナックバーでメッセージ表示、`/login` へ遷移。
  - エラー時: スナックバーでエラーメッセージ表示。
- **テスト**:
  - `register.component.spec.ts` を更新（8件のテストケース）。
  - スタンドアロンコンポーネントに対して `overrideComponent` でプロバイダーを正しく注入。
  - フォームバリデーション、サービス呼び出し、成功・失敗時の挙動を検証。
- **検証**:
  - 全8件のテストが成功。


